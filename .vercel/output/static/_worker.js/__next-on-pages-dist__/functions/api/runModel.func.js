import{__getNamedExports as Fr}from"../../../__next-on-pages-dist__/webpack/43f76069387da34d9759fd763b0079e5.js";import{__getNamedExports as Lr}from"../../../__next-on-pages-dist__/webpack/cfe30fc2aa3258c87f4442eb84480cb6.js";import{__getNamedExports as Ur}from"../../../__next-on-pages-dist__/webpack/2016.js";import{__getNamedExports as Wr}from"../../../__next-on-pages-dist__/manifest/27d10e462fba646daaa29468a0656e12.js";var _e=globalThis.__nextOnPagesRoutesIsolation.getProxyFor("/api/runModel"),re=Fr(_e,_e,_e),Jr=re.__chunk_6774,Hr=re.__chunk_7809,Kr=re.__chunk_7584,Gr=re.__chunk_8216,Xr=re.__chunk_4275,Vr=re.__chunk_6438,zr=re.__chunk_6558,Qr=re.__chunk_5936,Yr=re.__chunk_4851,Zr=re.__chunk_1725,ea=re.__chunk_2035,ta=re.__chunk_7785,sa=re.__chunk_2144,na=re.__chunk_7988,ra=re.__chunk_7212,aa=re.__chunk_9504,ia=re.__chunk_7484,oa=re.__chunk_3444,la=re.__chunk_2834,ca=re.__chunk_8050,ua=re.__chunk_5466,ha=re.__chunk_5503,da=re.__chunk_6195,fa=re.__chunk_2067,te=Lr(_e,_e,_e),pa=te.__chunk_8278,ma=te.__chunk_2745,ga=te.__chunk_1797,_a=te.__chunk_2036,ya=te.__chunk_966,wa=te.__chunk_7502,ba=te.__chunk_9386,va=te.__chunk_4606,xa=te.__chunk_7899,Ea=te.__chunk_2200,ka=te.__chunk_3578,Aa=te.__chunk_7756,Sa=te.__chunk_9135,Pa=te.__chunk_1622,Ra=te.__chunk_8055,Oa=te.__chunk_7795,Ia=te.__chunk_1430,$a=te.__chunk_6329,Ca=te.__chunk_1316,Ta=te.__chunk_9532,ja=te.__chunk_6840,Na=te.__chunk_4464,Ma=te.__chunk_9726,qa=te.__chunk_261,Ba=te.__chunk_6225,Da=te.__chunk_678,Fa=Ur(_e,_e,_e),La=Fa.__chunk_2016,Rs=Wr(_e,_e,_e),Ua=Rs.__NEXT_FONT_MANIFEST,Wa=Rs.__REACT_LOADABLE_MANIFEST,Ja=Rs.__BUILD_MANIFEST,za=((Le,Pe,Ha)=>(Pe._ENTRIES={},Le.__BUILD_MANIFEST=Ja,Le.__REACT_LOADABLE_MANIFEST=Wa,Le.__NEXT_FONT_MANIFEST=Ua,Le.__PRERENDER_MANIFEST='{"version":4,"routes":{},"dynamicRoutes":{},"notFoundRoutes":[],"preview":{"previewModeId":"610a7ecd2df716b353bc1accb95b0f8e","previewModeSigningKey":"43725094f081d52f19f608cd637d5b8e55e6bc41e42f6643f835b4d7d715172b","previewModeEncryptionKey":"105f06a2791ae126aa6cef066dd091b866be14007071d046f8fd076b4373f3b2"}}',(()=>{"use strict";var N={},q={};function u(d){var b=q[d];if(b!==void 0)return b.exports;var p=q[d]={exports:{}},M=!0;try{N[d](p,p.exports,u),M=!1}finally{M&&delete q[d]}return p.exports}u.m=N,(()=>{var d=[];u.O=(b,p,M,P)=>{if(p){P=P||0;for(var g=d.length;g>0&&d[g-1][2]>P;g--)d[g]=d[g-1];d[g]=[p,M,P];return}for(var x=1/0,g=0;g<d.length;g++){for(var[p,M,P]=d[g],m=!0,y=0;y<p.length;y++)(P&!1||x>=P)&&Object.keys(u.O).every(k=>u.O[k](p[y]))?p.splice(y--,1):(m=!1,P<x&&(x=P));if(m){d.splice(g--,1);var f=M();f!==void 0&&(b=f)}}return b}})(),u.n=d=>{var b=d&&d.__esModule?()=>d.default:()=>d;return u.d(b,{a:b}),b},(()=>{var d=Object.getPrototypeOf?p=>Object.getPrototypeOf(p):p=>p.__proto__,b;u.t=function(p,M){if(M&1&&(p=this(p)),M&8||typeof p=="object"&&p&&(M&4&&p.__esModule||M&16&&typeof p.then=="function"))return p;var P=Object.create(null);u.r(P);var g={};b=b||[null,d({}),d([]),d(d)];for(var x=M&2&&p;typeof x=="object"&&!~b.indexOf(x);x=d(x))Object.getOwnPropertyNames(x).forEach(m=>g[m]=()=>p[m]);return g.default=()=>p,u.d(P,g),P}})(),u.d=(d,b)=>{for(var p in b)u.o(b,p)&&!u.o(d,p)&&Object.defineProperty(d,p,{enumerable:!0,get:b[p]})},u.e=()=>Promise.resolve(),u.g=function(){if(typeof Pe=="object")return Pe;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),u.o=(d,b)=>Object.prototype.hasOwnProperty.call(d,b),u.r=d=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},(()=>{var d={993:0};u.O.j=M=>d[M]===0;var b=(M,P)=>{var[g,x,m]=P,y,f,h=0;if(g.some(E=>d[E]!==0)){for(y in x)u.o(x,y)&&(u.m[y]=x[y]);if(m)var T=m(u)}for(M&&M(P);h<g.length;h++)f=g[h],u.o(d,f)&&d[f]&&d[f][0](),d[f]=0;return u.O(T)},p=Le.webpackChunk_N_E=Le.webpackChunk_N_E||[];p.forEach(b.bind(null,0)),p.push=b.bind(null,p.push.bind(p))})()})(),(Le.webpackChunk_N_E=Le.webpackChunk_N_E||[]).push([[916],{1939:N=>{function q(u){var d=Error("Cannot find module '"+u+"'");throw d.code="MODULE_NOT_FOUND",d}q.keys=()=>[],q.resolve=q,q.id=1939,N.exports=q},2067:fa,6195:da,9142:(N,q,u)=>{"use strict";let d,b,p,M,P,g,x,m,y,f;u.r(q),u.d(q,{ComponentMod:()=>qr,default:()=>Br});var h,T,E,c,k,w,R,O,F,A,J,D,j,ie,B,H,ne,ye,Re,Ee,Be,Ue,G,z,me,We,Mt,bt,qt,Bt,Dt,vt,Ft,Os,he,Lt,Te,xt,Oe,He,ze,Ke,Et,ke,kt,At,ot,lt,ct,Is,$s,Cs,Ts,js,Ns,Ms,Ut={};u.r(Ut),u.d(Ut,{POST:()=>$r,runtime:()=>Ir});var Wt={};u.r(Wt),u.d(Wt,{headerHooks:()=>Tr,originalPathname:()=>Nr,patchFetch:()=>Mr,requestAsyncStorage:()=>Cr,routeModule:()=>ks,serverHooks:()=>Mn,staticGenerationAsyncStorage:()=>Nn,staticGenerationBailout:()=>jr});var Ln=u(8055),Un=u(1430),Wn=u(5936),Jn=u(6558),Hn=u(9572),Kn=u.n(Hn);let Jt="RFC3986",Ht={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},Gn=Array.isArray,je=(()=>{let n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})();function qs(n,e){if(Gn(n)){let t=[];for(let s=0;s<n.length;s+=1)t.push(e(n[s]));return t}return e(n)}let Xn=Object.prototype.hasOwnProperty,Bs={brackets:n=>String(n)+"[]",comma:"comma",indices:(n,e)=>String(n)+"["+e+"]",repeat:n=>String(n)},Ne=Array.isArray,Vn=Array.prototype.push,Ds=function(n,e){Vn.apply(n,Ne(e)?e:[e])},zn=Date.prototype.toISOString,ce={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(n,e,t,s,r)=>{if(n.length===0)return n;let a=n;if(typeof n=="symbol"?a=Symbol.prototype.toString.call(n):typeof n!="string"&&(a=String(n)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(l){return"%26%23"+parseInt(l.slice(2),16)+"%3B"});let i="";for(let l=0;l<a.length;l+=1024){let C=a.length>=1024?a.slice(l,l+1024):a,I=[];for(let W=0;W<C.length;++W){let _=C.charCodeAt(W);if(_===45||_===46||_===95||_===126||_>=48&&_<=57||_>=65&&_<=90||_>=97&&_<=122||r==="RFC1738"&&(_===40||_===41)){I[I.length]=C.charAt(W);continue}if(_<128){I[I.length]=je[_];continue}if(_<2048){I[I.length]=je[192|_>>6]+je[128|63&_];continue}if(_<55296||_>=57344){I[I.length]=je[224|_>>12]+je[128|_>>6&63]+je[128|63&_];continue}W+=1,_=65536+((1023&_)<<10|1023&C.charCodeAt(W)),I[I.length]=je[240|_>>18]+je[128|_>>12&63]+je[128|_>>6&63]+je[128|63&_]}i+=I.join("")}return i},encodeValuesOnly:!1,format:Jt,formatter:Ht[Jt],indices:!1,serializeDate:n=>zn.call(n),skipNulls:!1,strictNullHandling:!1},Kt={},Gt="4.70.2",Fs=!1;class Qn{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}b||function(n,e={auto:!1}){if(Fs)throw Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(b)throw Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${b}'\``);Fs=e.auto,b=n.kind,p=n.fetch,n.Request,n.Response,n.Headers,M=n.FormData,n.Blob,P=n.File,g=n.ReadableStream,x=n.getMultipartRequestOptions,m=n.getDefaultAgent,y=n.fileFromPath,f=n.isFsReadStream}(function({manuallyImported:n}={}){let e,t,s,r,a=n?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";try{e=fetch,t=Request,s=Response,r=Headers}catch(i){throw Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${a}`)}return{kind:"web",fetch:e,Request:t,Response:s,Headers:r,FormData:typeof FormData<"u"?FormData:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${a}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${a}`)}},File:typeof File<"u"?File:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${a}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${a}`)}},getMultipartRequestOptions:async(i,l)=>({...l,body:new Qn(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}(),{auto:!0});class L extends Error{}class de extends L{constructor(e,t,s,r){super(`${de.makeMessage(e,t,s)}`),this.status=e,this.headers=r,this.request_id=r?.["x-request-id"],this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,s){let r=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,s,r){if(!e)return new St({message:s,cause:Zt(t)});let a=t?.error;return e===400?new Ls(e,a,s,r):e===401?new Us(e,a,s,r):e===403?new Ws(e,a,s,r):e===404?new Js(e,a,s,r):e===409?new Hs(e,a,s,r):e===422?new Ks(e,a,s,r):e===429?new Gs(e,a,s,r):e>=500?new Xs(e,a,s,r):new de(e,a,s,r)}}class Ie extends de{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class St extends de{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class Xt extends St{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Ls extends de{constructor(){super(...arguments),this.status=400}}class Us extends de{constructor(){super(...arguments),this.status=401}}class Ws extends de{constructor(){super(...arguments),this.status=403}}class Js extends de{constructor(){super(...arguments),this.status=404}}class Hs extends de{constructor(){super(...arguments),this.status=409}}class Ks extends de{constructor(){super(...arguments),this.status=422}}class Gs extends de{constructor(){super(...arguments),this.status=429}}class Xs extends de{}class Vs extends L{constructor(){super("Could not parse response content as the length limit was reached")}}class zs extends L{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var Vt=u(6195).Buffer;class Ge{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];let s=Ge.NEWLINE_CHARS.has(t[t.length-1]||""),r=t.split(Ge.NEWLINE_REGEXP);return s&&r.pop(),r.length!==1||s?(this.buffer.length>0&&(r=[this.buffer.join("")+r[0],...r.slice(1)],this.buffer=[]),s||(this.buffer=[r.pop()||""]),r):(this.buffer.push(r[0]),[])}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(Vt!==void 0){if(e instanceof Vt)return e.toString();if(e instanceof Uint8Array)return Vt.from(e).toString();throw new L(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new L(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new L("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}Ge.NEWLINE_CHARS=new Set([`
`,"\r"]),Ge.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class Me{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let s=!1;return new Me(async function*(){if(s)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let r=!1;try{for await(let a of Yn(e,t))if(!r){if(a.data.startsWith("[DONE]")){r=!0;continue}if(a.event===null){let i;try{i=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(i&&i.error)throw new de(void 0,i.error,void 0,void 0);yield i}else{let i;try{i=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(a.event=="error")throw new de(void 0,i.error,i.message,void 0);yield{event:a.event,data:i}}}r=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{r||t.abort()}},t)}static fromReadableStream(e,t){let s=!1;async function*r(){let a=new Ge;for await(let i of Qs(e))for(let l of a.decode(i))yield l;for(let i of a.flush())yield i}return new Me(async function*(){if(s)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let a=!1;try{for await(let i of r())!a&&i&&(yield JSON.parse(i));a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||t.abort()}},t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),r=a=>({next:()=>{if(a.length===0){let i=s.next();e.push(i),t.push(i)}return a.shift()}});return[new Me(()=>r(e),this.controller),new Me(()=>r(t),this.controller)]}toReadableStream(){let e,t=this,s=new TextEncoder;return new g({async start(){e=t[Symbol.asyncIterator]()},async pull(r){try{let{value:a,done:i}=await e.next();if(i)return r.close();let l=s.encode(JSON.stringify(a)+`
`);r.enqueue(l)}catch(a){r.error(a)}},async cancel(){await e.return?.()}})}}async function*Yn(n,e){if(!n.body)throw e.abort(),new L("Attempted to iterate over a response with no body");let t=new er,s=new Ge;for await(let r of Zn(Qs(n.body)))for(let a of s.decode(r)){let i=t.decode(a);i&&(yield i)}for(let r of s.flush()){let a=t.decode(r);a&&(yield a)}}async function*Zn(n){let e=new Uint8Array;for await(let t of n){let s;if(t==null)continue;let r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t,a=new Uint8Array(e.length+r.length);for(a.set(e),a.set(r,e.length),e=a;(s=function(i){for(let l=0;l<i.length-2;l++){if(i[l]===10&&i[l+1]===10||i[l]===13&&i[l+1]===13)return l+2;if(i[l]===13&&i[l+1]===10&&l+3<i.length&&i[l+2]===13&&i[l+3]===10)return l+4}return-1}(e))!==-1;)yield e.slice(0,s),e=e.slice(s)}e.length>0&&(yield e)}class er{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,r]=function(a,i){let l=a.indexOf(i);return l!==-1?[a.substring(0,l),i,a.substring(l+i.length)]:[a,"",""]}(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}}function Qs(n){if(n[Symbol.asyncIterator])return n;let e=n.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var Ys=u(6195).Buffer;let Zs=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",en=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Pt(n),Pt=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",tn=n=>en(n)||Zs(n)||f(n);async function sn(n,e,t){var s;if(en(n=await n))return n;if(Zs(n)){let a=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");let i=Pt(a)?[await a.arrayBuffer()]:[a];return new P(i,e,t)}let r=await tr(n);if(e||(e=(zt((s=n).name)||zt(s.filename)||zt(s.path)?.split(/[\\/]/).pop())??"unknown_file"),!t?.type){let a=r[0]?.type;typeof a=="string"&&(t={...t,type:a})}return new P(r,e,t)}async function tr(n){let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Pt(n))e.push(await n.arrayBuffer());else if(sr(n))for await(let t of n)e.push(t);else throw Error(`Unexpected data type: ${typeof n}; constructor: ${n?.constructor?.name}; props: ${function(t){return`[${Object.getOwnPropertyNames(t).map(r=>`"${r}"`).join(", ")}]`}(n)}`);return e}let zt=n=>typeof n=="string"?n:Ys!==void 0&&n instanceof Ys?String(n):void 0,sr=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",nn=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",Qe=async n=>{let e=await nr(n.body);return x(e,n)},nr=async n=>{let e=new M;return await Promise.all(Object.entries(n||{}).map(([t,s])=>Qt(e,t,s))),e},rn=n=>{if(tn(n))return!0;if(Array.isArray(n))return n.some(rn);if(n&&typeof n=="object"){for(let e in n)if(rn(n[e]))return!0}return!1},Qt=async(n,e,t)=>{if(t!==void 0){if(t==null)throw TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(tn(t)){let s=await sn(t);n.append(e,s)}else if(Array.isArray(t))await Promise.all(t.map(s=>Qt(n,e+"[]",s)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([s,r])=>Qt(n,`${e}[${s}]`,r)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var an=u(6195).Buffer,rr=function(n,e,t,s,r){if(s==="m")throw TypeError("Private method is not writable");if(s==="a"&&!r)throw TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?r.call(n,t):r?r.value=t:e.set(n,t),t},ar=function(n,e,t,s){if(t==="a"&&!s)throw TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)};async function on(n){let{response:e}=n;if(n.options.stream)return Ye("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Me.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;let t=e.headers.get("content-type");if(t?.includes("application/json")||t?.includes("application/vnd.api+json")){let r=await e.json();return Ye("response",e.status,e.url,e.headers,r),ln(r,e)}let s=await e.text();return Ye("response",e.status,e.url,e.headers,s),s}function ln(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class Rt extends Promise{constructor(e,t=on){super(s=>{s(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Rt(this.responsePromise,async t=>ln(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class ir{constructor({baseURL:e,maxRetries:t=2,timeout:s=6e5,httpAgent:r,fetch:a}){this.baseURL=e,this.maxRetries=Yt("maxRetries",t),this.timeout=Yt("timeout",s),this.httpAgent=r,this.fetch=a??p}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...fr(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${_r()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(async r=>{let a=r&&Pt(r?.body)?new DataView(await r.body.arrayBuffer()):r?.body instanceof DataView?r.body:r?.body instanceof ArrayBuffer?new DataView(r.body):r&&ArrayBuffer.isView(r?.body)?new DataView(r.body.buffer):r?.body;return{method:e,path:t,...r,body:a}}))}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}calculateContentLength(e){if(typeof e=="string"){if(an!==void 0)return an.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){let{method:s,path:r,query:a,headers:i={}}=e,l=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:nn(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,C=this.calculateContentLength(l),I=this.buildURL(r,a);"timeout"in e&&Yt("timeout",e.timeout);let W=e.timeout??this.timeout,_=e.httpAgent??this.httpAgent??m(I),v=W+1e3;typeof _?.options?.timeout=="number"&&v>(_.options.timeout??0)&&(_.options.timeout=v),this.idempotencyHeader&&s!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let o=this.buildHeaders({options:e,headers:i,contentLength:C,retryCount:t});return{req:{method:s,...l&&{body:l},headers:o,..._&&{agent:_},signal:e.signal??null},url:I,timeout:W}}buildHeaders({options:e,headers:t,contentLength:s,retryCount:r}){let a={};s&&(a["content-length"]=s);let i=this.defaultHeaders(e);return dn(a,i),dn(a,t),nn(e.body)&&b!=="node"&&delete a["content-type"],fn(i,"x-stainless-retry-count")===void 0&&fn(t,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(r)),this.validateHeaders(a,t),a}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,s,r){return de.generate(e,t,s,r)}request(e,t=null){return new Rt(this.makeRequest(e,t))}async makeRequest(e,t){let s=await e,r=s.maxRetries??this.maxRetries;t==null&&(t=r),await this.prepareOptions(s);let{req:a,url:i,timeout:l}=this.buildRequest(s,{retryCount:r-t});if(await this.prepareRequest(a,{url:i,options:s}),Ye("request",i,s,a.headers),s.signal?.aborted)throw new Ie;let C=new AbortController,I=await this.fetchWithTimeout(i,a,l,C).catch(Zt);if(I instanceof Error){if(s.signal?.aborted)throw new Ie;if(t)return this.retryRequest(s,t);throw I.name==="AbortError"?new Xt:new St({cause:I})}let W=lr(I.headers);if(!I.ok){if(t&&this.shouldRetry(I)){let oe=`retrying, ${t} attempts remaining`;return Ye(`response (error; ${oe})`,I.status,i,W),this.retryRequest(s,t,W)}let _=await I.text().catch(oe=>Zt(oe).message),v=pr(_),o=v?void 0:_;throw Ye(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,I.status,i,W,o),this.makeStatusError(I.status,v,o,W)}return{response:I,options:s,controller:C}}requestAPIList(e,t){return new or(this,this.makeRequest(t,null),e)}buildURL(e,t){let s=new URL(gr(e)?e:this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return un(r)||(t={...r,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,s])=>s!==void 0).map(([t,s])=>{if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(s)}`;if(s===null)return`${encodeURIComponent(t)}=`;throw new L(`Cannot stringify type ${typeof s}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,s,r){let{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>r.abort());let l=setTimeout(()=>r.abort(),s);return this.getRequestClient().fetch.call(void 0,e,{signal:r.signal,...i}).finally(()=>{clearTimeout(l)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"||t!=="false"&&(e.status===408||e.status===409||e.status===429||e.status>=500)}async retryRequest(e,t,s){let r,a=s?.["retry-after-ms"];if(a){let l=parseFloat(a);Number.isNaN(l)||(r=l)}let i=s?.["retry-after"];if(i&&!r){let l=parseFloat(i);r=Number.isNaN(l)?Date.parse(i)-Date.now():1e3*l}if(!(r&&0<=r&&r<6e4)){let l=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,l)}return await ut(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Gt}`}}class cn{constructor(e,t,s,r){h.set(this,void 0),rr(this,h,e,"f"),this.options=r,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&this.nextPageInfo()!=null}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new L("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){for(let[s,r]of[...Object.entries(t.query||{}),...e.url.searchParams.entries()])e.url.searchParams.set(s,r);t.query=void 0,t.path=e.url.toString()}return await ar(this,h,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(h=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class or extends Rt{constructor(e,t,s){super(t,async r=>new s(e,r.response,await on(r),r.options))}async*[Symbol.asyncIterator](){for await(let e of await this)yield e}}let lr=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){let s=t.toString();return e[s.toLowerCase()]||e[s]}}),cr={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},we=n=>typeof n=="object"&&n!==null&&!un(n)&&Object.keys(n).every(e=>hn(cr,e)),ur=()=>typeof Deno<"u"&&Deno.build!=null?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Gt,"X-Stainless-OS":dr(Deno.build.os),"X-Stainless-Arch":hr(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Gt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"other:vercel","X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version},hr=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",dr=n=>(n=n.toLowerCase()).includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown",fr=()=>d??(d=ur()),pr=n=>{try{return JSON.parse(n)}catch{return}},mr=RegExp("^(?:[a-z]+:)?//","i"),gr=n=>mr.test(n),ut=n=>new Promise(e=>setTimeout(e,n)),Yt=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new L(`${n} must be an integer`);if(e<0)throw new L(`${n} must be a positive integer`);return e},Zt=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return Error(JSON.stringify(n))}catch{}return Error(n)},Ot=n=>typeof process<"u"?process.env?.[n]?.trim()??void 0:typeof Deno<"u"?Deno.env?.get?.(n)?.trim():void 0;function un(n){if(!n)return!0;for(let e in n)return!1;return!0}function hn(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function dn(n,e){for(let t in e){if(!hn(e,t))continue;let s=t.toLowerCase();if(!s)continue;let r=e[t];r===null?delete n[s]:r!==void 0&&(n[s]=r)}}function Ye(n,...e){typeof process<"u"&&process?.env?.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}let _r=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{let e=16*Math.random()|0;return(n==="x"?e:3&e|8).toString(16)}),yr=()=>!1,wr=n=>typeof n?.get=="function",fn=(n,e)=>{let t=e.toLowerCase();if(wr(n)){let s=e[0]?.toUpperCase()+e.substring(1).replace(/([^\w])(\w)/g,(r,a,i)=>a+i.toUpperCase());for(let r of[e,t,e.toUpperCase(),s]){let a=n.get(r);if(a)return a}}for(let[s,r]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(r)?(r.length<=1||console.warn(`Received ${r.length} entries for the ${e} header, using the first entry.`),r[0]):r};function es(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}class K{constructor(e){this._client=e}}class pn extends K{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class mn extends K{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}}class ts extends K{constructor(){super(...arguments),this.completions=new mn(this._client)}}ts.Completions=mn;class gn extends K{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class _n extends cn{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class qe extends cn{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){let e=this.getPaginatedItems();if(!e.length)return null;let t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class ss extends K{create(e,t){return this._client.post("/files",Qe({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return we(e)?this.list({},e):this._client.getAPIList("/files",ns,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t?.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){let r=new Set(["processed","error","deleted"]),a=Date.now(),i=await this.retrieve(e);for(;!i.status||!r.has(i.status);)if(await ut(t),i=await this.retrieve(e),Date.now()-a>s)throw new Xt({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return i}}class ns extends _n{}ss.FileObjectsPage=ns;class yn extends K{createVariation(e,t){return this._client.post("/images/variations",Qe({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Qe({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class wn extends K{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}class bn extends K{create(e,t){return this._client.post("/audio/transcriptions",Qe({body:e,...t}))}}class vn extends K{create(e,t){return this._client.post("/audio/translations",Qe({body:e,...t}))}}class ht extends K{constructor(){super(...arguments),this.transcriptions=new bn(this._client),this.translations=new vn(this._client),this.speech=new wn(this._client)}}ht.Transcriptions=bn,ht.Translations=vn,ht.Speech=wn;class xn extends K{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class rs extends K{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",as,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class as extends _n{}rs.ModelsPage=as;class is extends K{list(e,t={},s){return we(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,os,{query:t,...s})}}class os extends qe{}is.FineTuningJobCheckpointsPage=os;class Ze extends K{constructor(){super(...arguments),this.checkpoints=new is(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return we(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",ls,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return we(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,cs,{query:t,...s})}}class ls extends qe{}class cs extends qe{}Ze.FineTuningJobsPage=ls,Ze.FineTuningJobEventsPage=cs,Ze.Checkpoints=is,Ze.FineTuningJobCheckpointsPage=os;class dt extends K{constructor(){super(...arguments),this.jobs=new Ze(this._client)}}dt.Jobs=Ze,dt.FineTuningJobsPage=ls,dt.FineTuningJobEventsPage=cs;class us extends K{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/assistants/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e={},t){return we(e)?this.list({},e):this._client.getAPIList("/assistants",hs,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class hs extends qe{}function En(n){return typeof n.parse=="function"}us.AssistantsPage=hs;let et=n=>n?.role==="assistant",kn=n=>n?.role==="function",An=n=>n?.role==="tool";var $e=function(n,e,t,s,r){if(s==="m")throw TypeError("Private method is not writable");if(s==="a"&&!r)throw TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?r.call(n,t):r?r.value=t:e.set(n,t),t},ae=function(n,e,t,s){if(t==="a"&&!s)throw TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)};class Sn{constructor(){T.add(this),this.controller=new AbortController,E.set(this,void 0),c.set(this,()=>{}),k.set(this,()=>{}),w.set(this,void 0),R.set(this,()=>{}),O.set(this,()=>{}),F.set(this,{}),A.set(this,!1),J.set(this,!1),D.set(this,!1),j.set(this,!1),$e(this,E,new Promise((e,t)=>{$e(this,c,e,"f"),$e(this,k,t,"f")}),"f"),$e(this,w,new Promise((e,t)=>{$e(this,R,e,"f"),$e(this,O,t,"f")}),"f"),ae(this,E,"f").catch(()=>{}),ae(this,w,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},ae(this,T,"m",ie).bind(this))},0)}_connected(){this.ended||(ae(this,c,"f").call(this),this._emit("connect"))}get ended(){return ae(this,A,"f")}get errored(){return ae(this,J,"f")}get aborted(){return ae(this,D,"f")}abort(){this.controller.abort()}on(e,t){return(ae(this,F,"f")[e]||(ae(this,F,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=ae(this,F,"f")[e];if(!s)return this;let r=s.findIndex(a=>a.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(ae(this,F,"f")[e]||(ae(this,F,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{$e(this,j,!0,"f"),e!=="error"&&this.once("error",s),this.once(e,t)})}async done(){$e(this,j,!0,"f"),await ae(this,w,"f")}_emit(e,...t){if(ae(this,A,"f"))return;e==="end"&&($e(this,A,!0,"f"),ae(this,R,"f").call(this));let s=ae(this,F,"f")[e];if(s&&(ae(this,F,"f")[e]=s.filter(r=>!r.once),s.forEach(({listener:r})=>r(...t))),e==="abort"){let r=t[0];ae(this,j,"f")||s?.length||Promise.reject(r),ae(this,k,"f").call(this,r),ae(this,O,"f").call(this,r),this._emit("end");return}if(e==="error"){let r=t[0];ae(this,j,"f")||s?.length||Promise.reject(r),ae(this,k,"f").call(this,r),ae(this,O,"f").call(this,r),this._emit("end")}}_emitFinal(){}}function Pn(n){return n?.$brand==="auto-parseable-response-format"}function ft(n){return n?.$brand==="auto-parseable-tool"}function ds(n,e){let t=n.choices.map(s=>{var r;if(s.finish_reason==="length")throw new Vs;if(s.finish_reason==="content_filter")throw new zs;return{...s,message:{...s.message,tool_calls:s.message.tool_calls?.map(a=>function(i,l){let C=i.tools?.find(I=>I.function?.name===l.function.name);return{...l,function:{...l.function,parsed_arguments:ft(C)?C.$parseRaw(l.function.arguments):C?.function.strict?JSON.parse(l.function.arguments):null}}}(e,a))??[],parsed:s.message.content&&!s.message.refusal?(r=s.message.content,e.response_format?.type!=="json_schema"?null:e.response_format?.type==="json_schema"?"$parseRaw"in e.response_format?e.response_format.$parseRaw(r):JSON.parse(r):null):null}}});return{...n,choices:t}}function Rn(n){return!!Pn(n.response_format)||(n.tools?.some(e=>ft(e)||e.type==="function"&&e.function.strict===!0)??!1)}E=new WeakMap,c=new WeakMap,k=new WeakMap,w=new WeakMap,R=new WeakMap,O=new WeakMap,F=new WeakMap,A=new WeakMap,J=new WeakMap,D=new WeakMap,j=new WeakMap,T=new WeakSet,ie=function(n){if($e(this,J,!0,"f"),n instanceof Error&&n.name==="AbortError"&&(n=new Ie),n instanceof Ie)return $e(this,D,!0,"f"),this._emit("abort",n);if(n instanceof L)return this._emit("error",n);if(n instanceof Error){let e=new L(n.message);return e.cause=n,this._emit("error",e)}return this._emit("error",new L(String(n)))};var be=function(n,e,t,s){if(t==="a"&&!s)throw TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)};class On extends Sn{constructor(){super(...arguments),B.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(kn(e)||An(e))&&e.content)this._emit("functionCallResult",e.content);else if(et(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(et(e)&&e.tool_calls)for(let s of e.tool_calls)s.type==="function"&&this._emit("functionCall",s.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new L("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),be(this,B,"m",H).call(this)}async finalMessage(){return await this.done(),be(this,B,"m",ne).call(this)}async finalFunctionCall(){return await this.done(),be(this,B,"m",ye).call(this)}async finalFunctionCallResult(){return await this.done(),be(this,B,"m",Re).call(this)}async totalUsage(){return await this.done(),be(this,B,"m",Ee).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=be(this,B,"m",ne).call(this);t&&this._emit("finalMessage",t);let s=be(this,B,"m",H).call(this);s&&this._emit("finalContent",s);let r=be(this,B,"m",ye).call(this);r&&this._emit("finalFunctionCall",r);let a=be(this,B,"m",Re).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",be(this,B,"m",Ee).call(this))}async _createChatCompletion(e,t,s){let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),be(this,B,"m",Be).call(this,t);let a=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(ds(a,t))}async _runChatCompletion(e,t,s){for(let r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,s)}async _runFunctions(e,t,s){let r="function",{function_call:a="auto",stream:i,...l}=t,C=typeof a!="string"&&a?.name,{maxChatCompletions:I=10}=s||{},W={};for(let v of t.functions)W[v.name||v.function.name]=v;let _=t.functions.map(v=>({name:v.name||v.function.name,parameters:v.parameters,description:v.description}));for(let v of t.messages)this._addMessage(v,!1);for(let v=0;v<I;++v){let o,$=await this._createChatCompletion(e,{...l,function_call:a,functions:_,messages:[...this.messages]},s),oe=$.choices[0]?.message;if(!oe)throw new L("missing message in ChatCompletion response");if(!oe.function_call)return;let{name:Q,arguments:Y}=oe.function_call,se=W[Q];if(se){if(C&&C!==Q){let Z=`Invalid function_call: ${JSON.stringify(Q)}. ${JSON.stringify(C)} requested. Please try again`;this._addMessage({role:r,name:Q,content:Z});continue}}else{let Z=`Invalid function_call: ${JSON.stringify(Q)}. Available options are: ${_.map(le=>JSON.stringify(le.name)).join(", ")}. Please try again`;this._addMessage({role:r,name:Q,content:Z});continue}try{o=En(se)?await se.parse(Y):Y}catch(Z){this._addMessage({role:r,name:Q,content:Z instanceof Error?Z.message:String(Z)});continue}let fe=await se.function(o,this),ve=be(this,B,"m",Ue).call(this,fe);if(this._addMessage({role:r,name:Q,content:ve}),C)return}}async _runTools(e,t,s){let r="tool",{tool_choice:a="auto",stream:i,...l}=t,C=typeof a!="string"&&a?.function?.name,{maxChatCompletions:I=10}=s||{},W=t.tools.map(o=>{if(ft(o)){if(!o.$callback)throw new L("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:o.$callback,name:o.function.name,description:o.function.description||"",parameters:o.function.parameters,parse:o.$parseRaw,strict:!0}}}return o}),_={};for(let o of W)o.type==="function"&&(_[o.function.name||o.function.function.name]=o.function);let v="tools"in t?W.map(o=>o.type==="function"?{type:"function",function:{name:o.function.name||o.function.function.name,parameters:o.function.parameters,description:o.function.description,strict:o.function.strict}}:o):void 0;for(let o of t.messages)this._addMessage(o,!1);for(let o=0;o<I;++o){let $=await this._createChatCompletion(e,{...l,tool_choice:a,tools:v,messages:[...this.messages]},s),oe=$.choices[0]?.message;if(!oe)throw new L("missing message in ChatCompletion response");if(!oe.tool_calls?.length)break;for(let Q of oe.tool_calls){let Y;if(Q.type!=="function")continue;let se=Q.id,{name:fe,arguments:ve}=Q.function,Z=_[fe];if(Z){if(C&&C!==fe){let ee=`Invalid tool_call: ${JSON.stringify(fe)}. ${JSON.stringify(C)} requested. Please try again`;this._addMessage({role:r,tool_call_id:se,content:ee});continue}}else{let ee=`Invalid tool_call: ${JSON.stringify(fe)}. Available options are: ${Object.keys(_).map(xe=>JSON.stringify(xe)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:se,content:ee});continue}try{Y=En(Z)?await Z.parse(ve):ve}catch(ee){let xe=ee instanceof Error?ee.message:String(ee);this._addMessage({role:r,tool_call_id:se,content:xe});continue}let le=await Z.function(Y,this),Se=be(this,B,"m",Ue).call(this,le);if(this._addMessage({role:r,tool_call_id:se,content:Se}),C)return}}}}B=new WeakSet,H=function(){return be(this,B,"m",ne).call(this).content??null},ne=function(){let n=this.messages.length;for(;n-- >0;){let e=this.messages[n];if(et(e)){let{function_call:t,...s}=e,r={...s,content:e.content??null,refusal:e.refusal??null};return t&&(r.function_call=t),r}}throw new L("stream ended without producing a ChatCompletionMessage with role=assistant")},ye=function(){for(let n=this.messages.length-1;n>=0;n--){let e=this.messages[n];if(et(e)&&e?.function_call)return e.function_call;if(et(e)&&e?.tool_calls?.length)return e.tool_calls.at(-1)?.function}},Re=function(){for(let n=this.messages.length-1;n>=0;n--){let e=this.messages[n];if(kn(e)&&e.content!=null||An(e)&&e.content!=null&&typeof e.content=="string"&&this.messages.some(t=>t.role==="assistant"&&t.tool_calls?.some(s=>s.type==="function"&&s.id===e.tool_call_id)))return e.content}},Ee=function(){let n={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:e}of this._chatCompletions)e&&(n.completion_tokens+=e.completion_tokens,n.prompt_tokens+=e.prompt_tokens,n.total_tokens+=e.total_tokens);return n},Be=function(n){if(n.n!=null&&n.n>1)throw new L("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Ue=function(n){return typeof n=="string"?n:n===void 0?"undefined":JSON.stringify(n)};class pt extends On{static runFunctions(e,t,s){let r=new pt,a={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,a)),r}static runTools(e,t,s){let r=new pt,a={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}_addMessage(e,t=!0){super._addMessage(e,t),et(e)&&e.content&&this._emit("content",e.content)}}let ue={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,ALL:511};class br extends Error{}class vr extends Error{}let xr=(n,e)=>{let t=n.length,s=0,r=v=>{throw new br(`${v} at position ${s}`)},a=v=>{throw new vr(`${v} at position ${s}`)},i=()=>(_(),s>=t&&r("Unexpected end of input"),n[s]==='"'?l():n[s]==="{"?C():n[s]==="["?I():n.substring(s,s+4)==="null"||ue.NULL&e&&t-s<4&&"null".startsWith(n.substring(s))?(s+=4,null):n.substring(s,s+4)==="true"||ue.BOOL&e&&t-s<4&&"true".startsWith(n.substring(s))?(s+=4,!0):n.substring(s,s+5)==="false"||ue.BOOL&e&&t-s<5&&"false".startsWith(n.substring(s))?(s+=5,!1):n.substring(s,s+8)==="Infinity"||ue.INFINITY&e&&t-s<8&&"Infinity".startsWith(n.substring(s))?(s+=8,1/0):n.substring(s,s+9)==="-Infinity"||ue.MINUS_INFINITY&e&&1<t-s&&t-s<9&&"-Infinity".startsWith(n.substring(s))?(s+=9,-1/0):n.substring(s,s+3)==="NaN"||ue.NAN&e&&t-s<3&&"NaN".startsWith(n.substring(s))?(s+=3,NaN):W()),l=()=>{let v=s,o=!1;for(s++;s<t&&(n[s]!=='"'||o&&n[s-1]==="\\");)o=n[s]==="\\"&&!o,s++;if(n.charAt(s)=='"')try{return JSON.parse(n.substring(v,++s-Number(o)))}catch($){a(String($))}else if(ue.STR&e)try{return JSON.parse(n.substring(v,s-Number(o))+'"')}catch{return JSON.parse(n.substring(v,n.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},C=()=>{s++,_();let v={};try{for(;n[s]!=="}";){if(_(),s>=t&&ue.OBJ&e)return v;let o=l();_(),s++;try{let $=i();Object.defineProperty(v,o,{value:$,writable:!0,enumerable:!0,configurable:!0})}catch($){if(ue.OBJ&e)return v;throw $}_(),n[s]===","&&s++}}catch{if(ue.OBJ&e)return v;r("Expected '}' at end of object")}return s++,v},I=()=>{s++;let v=[];try{for(;n[s]!=="]";)v.push(i()),_(),n[s]===","&&s++}catch{if(ue.ARR&e)return v;r("Expected ']' at end of array")}return s++,v},W=()=>{if(s===0){n==="-"&&ue.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(n)}catch(o){if(ue.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}a(String(o))}}let v=s;for(n[s]==="-"&&s++;n[s]&&!",]}".includes(n[s]);)s++;s!=t||ue.NUM&e||r("Unterminated number literal");try{return JSON.parse(n.substring(v,s))}catch{n.substring(v,s)==="-"&&ue.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(n.substring(v,n.lastIndexOf("e")))}catch($){a(String($))}}},_=()=>{for(;s<t&&` 
\r	`.includes(n[s]);)s++};return i()},In=n=>function(e,t=ue.ALL){if(typeof e!="string")throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return xr(e.trim(),t)}(n,ue.ALL^ue.NUM);var tt=function(n,e,t,s,r){if(s==="m")throw TypeError("Private method is not writable");if(s==="a"&&!r)throw TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?r.call(n,t):r?r.value=t:e.set(n,t),t},X=function(n,e,t,s){if(t==="a"&&!s)throw TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)};class mt extends On{constructor(e){super(),G.add(this),z.set(this,void 0),me.set(this,void 0),We.set(this,void 0),tt(this,z,e,"f"),tt(this,me,[],"f")}get currentChatCompletionSnapshot(){return X(this,We,"f")}static fromReadableStream(e){let t=new mt(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){let r=new mt(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,s){super._createChatCompletion;let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),X(this,G,"m",Mt).call(this);let a=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});for await(let i of(this._connected(),a))X(this,G,"m",qt).call(this,i);if(a.controller.signal?.aborted)throw new Ie;return this._addChatCompletion(X(this,G,"m",vt).call(this))}async _fromReadableStream(e,t){let s,r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),X(this,G,"m",Mt).call(this),this._connected();let a=Me.fromReadableStream(e,this.controller);for await(let i of a)s&&s!==i.id&&this._addChatCompletion(X(this,G,"m",vt).call(this)),X(this,G,"m",qt).call(this,i),s=i.id;if(a.controller.signal?.aborted)throw new Ie;return this._addChatCompletion(X(this,G,"m",vt).call(this))}[(z=new WeakMap,me=new WeakMap,We=new WeakMap,G=new WeakSet,Mt=function(){this.ended||tt(this,We,void 0,"f")},bt=function(e){let t=X(this,me,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},X(this,me,"f")[e.index]=t),t},qt=function(e){if(this.ended)return;let t=X(this,G,"m",Os).call(this,e);for(let s of(this._emit("chunk",e,t),e.choices)){let r=t.choices[s.index];s.delta.content!=null&&r.message?.role==="assistant"&&r.message?.content&&(this._emit("content",s.delta.content,r.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:r.message.content,parsed:r.message.parsed})),s.delta.refusal!=null&&r.message?.role==="assistant"&&r.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:r.message.refusal}),s.logprobs?.content!=null&&r.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:r.logprobs?.content??[]}),s.logprobs?.refusal!=null&&r.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:r.logprobs?.refusal??[]});let a=X(this,G,"m",bt).call(this,r);for(let i of(r.finish_reason&&(X(this,G,"m",Dt).call(this,r),a.current_tool_call_index!=null&&X(this,G,"m",Bt).call(this,r,a.current_tool_call_index)),s.delta.tool_calls??[]))a.current_tool_call_index!==i.index&&(X(this,G,"m",Dt).call(this,r),a.current_tool_call_index!=null&&X(this,G,"m",Bt).call(this,r,a.current_tool_call_index)),a.current_tool_call_index=i.index;for(let i of s.delta.tool_calls??[]){let l=r.message.tool_calls?.[i.index];l?.type&&(l?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:l.function?.name,index:i.index,arguments:l.function.arguments,parsed_arguments:l.function.parsed_arguments,arguments_delta:i.function?.arguments??""}):l?.type)}}},Bt=function(e,t){if(X(this,G,"m",bt).call(this,e).done_tool_calls.has(t))return;let s=e.message.tool_calls?.[t];if(!s)throw Error("no tool call snapshot");if(!s.type)throw Error("tool call snapshot missing `type`");if(s.type==="function"){let r=X(this,z,"f")?.tools?.find(a=>a.type==="function"&&a.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:t,arguments:s.function.arguments,parsed_arguments:ft(r)?r.$parseRaw(s.function.arguments):r?.function.strict?JSON.parse(s.function.arguments):null})}else s.type},Dt=function(e){let t=X(this,G,"m",bt).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let s=X(this,G,"m",Ft).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},vt=function(){if(this.ended)throw new L("stream has ended, this shouldn't happen");let e=X(this,We,"f");if(!e)throw new L("request ended without sending any chunks");return tt(this,We,void 0,"f"),tt(this,me,[],"f"),function(t,s){var r;let{id:a,choices:i,created:l,model:C,system_fingerprint:I,...W}=t;return r={...W,id:a,choices:i.map(({message:_,finish_reason:v,index:o,logprobs:$,...oe})=>{if(!v)throw new L(`missing finish_reason for choice ${o}`);let{content:Q=null,function_call:Y,tool_calls:se,...fe}=_,ve=_.role;if(!ve)throw new L(`missing role for choice ${o}`);if(Y){let{arguments:Z,name:le}=Y;if(Z==null)throw new L(`missing function_call.arguments for choice ${o}`);if(!le)throw new L(`missing function_call.name for choice ${o}`);return{...oe,message:{content:Q,function_call:{arguments:Z,name:le},role:ve,refusal:_.refusal??null},finish_reason:v,index:o,logprobs:$}}return se?{...oe,index:o,finish_reason:v,logprobs:$,message:{...fe,role:ve,content:Q,refusal:_.refusal??null,tool_calls:se.map((Z,le)=>{let{function:Se,type:ee,id:xe,...pe}=Z,{arguments:De,name:Je,...Fe}=Se||{};if(xe==null)throw new L(`missing choices[${o}].tool_calls[${le}].id
${It(t)}`);if(ee==null)throw new L(`missing choices[${o}].tool_calls[${le}].type
${It(t)}`);if(Je==null)throw new L(`missing choices[${o}].tool_calls[${le}].function.name
${It(t)}`);if(De==null)throw new L(`missing choices[${o}].tool_calls[${le}].function.arguments
${It(t)}`);return{...pe,id:xe,type:ee,function:{...Fe,name:Je,arguments:De}}})}}:{...oe,message:{...fe,content:Q,role:ve,refusal:_.refusal??null},finish_reason:v,index:o,logprobs:$}}),created:l,model:C,object:"chat.completion",...I?{system_fingerprint:I}:{}},s&&Rn(s)?ds(r,s):{...r,choices:r.choices.map(_=>({..._,message:{..._.message,parsed:null,tool_calls:_.message.tool_calls??[]}}))}}(e,X(this,z,"f"))},Ft=function(){let e=X(this,z,"f")?.response_format;return Pn(e)?e:null},Os=function(e){var t,s,r,a;let i=X(this,We,"f"),{choices:l,...C}=e;for(let{delta:I,finish_reason:W,index:_,logprobs:v=null,...o}of(i?Object.assign(i,C):i=tt(this,We,{...C,choices:[]},"f"),e.choices)){let $=i.choices[_];if($||($=i.choices[_]={finish_reason:W,index:_,message:{},logprobs:v,...o}),v)if($.logprobs){let{content:Z,refusal:le,...Se}=v;Object.assign($.logprobs,Se),Z&&((t=$.logprobs).content??(t.content=[]),$.logprobs.content.push(...Z)),le&&((s=$.logprobs).refusal??(s.refusal=[]),$.logprobs.refusal.push(...le))}else $.logprobs=Object.assign({},v);if(W&&($.finish_reason=W,X(this,z,"f")&&Rn(X(this,z,"f")))){if(W==="length")throw new Vs;if(W==="content_filter")throw new zs}if(Object.assign($,o),!I)continue;let{content:oe,refusal:Q,function_call:Y,role:se,tool_calls:fe,...ve}=I;if(Object.assign($.message,ve),Q&&($.message.refusal=($.message.refusal||"")+Q),se&&($.message.role=se),Y&&($.message.function_call?(Y.name&&($.message.function_call.name=Y.name),Y.arguments&&((r=$.message.function_call).arguments??(r.arguments=""),$.message.function_call.arguments+=Y.arguments)):$.message.function_call=Y),oe&&($.message.content=($.message.content||"")+oe,!$.message.refusal&&X(this,G,"m",Ft).call(this)&&($.message.parsed=In($.message.content))),fe)for(let{index:Z,id:le,type:Se,function:ee,...xe}of($.message.tool_calls||($.message.tool_calls=[]),fe)){let pe=(a=$.message.tool_calls)[Z]??(a[Z]={});Object.assign(pe,xe),le&&(pe.id=le),Se&&(pe.type=Se),ee&&(pe.function??(pe.function={name:ee.name??"",arguments:""})),ee?.name&&(pe.function.name=ee.name),ee?.arguments&&(pe.function.arguments+=ee.arguments,function(De,Je){if(!De)return!1;let Fe=De.tools?.find(Ve=>Ve.function?.name===Je.function.name);return ft(Fe)||Fe?.function.strict||!1}(X(this,z,"f"),pe)&&(pe.function.parsed_arguments=In(pe.function.arguments)))}}return i},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("chunk",r=>{let a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{for(let r of(s=!0,t))r.resolve(void 0);t.length=0}),this.on("abort",r=>{for(let a of(s=!0,t))a.reject(r);t.length=0}),this.on("error",r=>{for(let a of(s=!0,t))a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,a)=>t.push({resolve:r,reject:a})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Me(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function It(n){return JSON.stringify(n)}class st extends mt{static fromReadableStream(e){let t=new st(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,s){let r=new st(null),a={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,a)),r}static runTools(e,t,s){let r=new st(t),a={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}}class $n extends K{parse(e,t){return function(s){for(let r of s??[]){if(r.type!=="function")throw new L(`Currently only \`function\` tool types support auto-parsing; Received \`${r.type}\``);if(r.function.strict!==!0)throw new L(`The \`${r.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(s=>ds(s,e))}runFunctions(e,t){return e.stream?st.runFunctions(this._client,e,t):pt.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?st.runTools(this._client,e,t):pt.runTools(this._client,e,t)}stream(e,t){return mt.createChatCompletion(this._client,e,t)}}class fs extends K{constructor(){super(...arguments),this.completions=new $n(this._client)}}(fs||(fs={})).Completions=$n;var S=function(n,e,t,s){if(t==="a"&&!s)throw TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},Ae=function(n,e,t,s,r){if(s==="m")throw TypeError("Private method is not writable");if(s==="a"&&!r)throw TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?r.call(n,t):r?r.value=t:e.set(n,t),t};class Ce extends Sn{constructor(){super(...arguments),he.add(this),Lt.set(this,[]),Te.set(this,{}),xt.set(this,{}),Oe.set(this,void 0),He.set(this,void 0),ze.set(this,void 0),Ke.set(this,void 0),Et.set(this,void 0),ke.set(this,void 0),kt.set(this,void 0),At.set(this,void 0),ot.set(this,void 0)}[(Lt=new WeakMap,Te=new WeakMap,xt=new WeakMap,Oe=new WeakMap,He=new WeakMap,ze=new WeakMap,Ke=new WeakMap,Et=new WeakMap,ke=new WeakMap,kt=new WeakMap,At=new WeakMap,ot=new WeakMap,he=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",r=>{let a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{for(let r of(s=!0,t))r.resolve(void 0);t.length=0}),this.on("abort",r=>{for(let a of(s=!0,t))a.reject(r);t.length=0}),this.on("error",r=>{for(let a of(s=!0,t))a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,a)=>t.push({resolve:r,reject:a})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new Ce;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();let r=Me.fromReadableStream(e,this.controller);for await(let a of r)S(this,he,"m",lt).call(this,a);if(r.controller.signal?.aborted)throw new Ie;return this._addRun(S(this,he,"m",ct).call(this))}toReadableStream(){return new Me(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,r,a){let i=new Ce;return i._run(()=>i._runToolAssistantStream(e,t,s,r,{...a,headers:{...a?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,s,r,a){let i=a?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let l={...r,stream:!0},C=await e.submitToolOutputs(t,s,l,{...a,signal:this.controller.signal});for await(let I of(this._connected(),C))S(this,he,"m",lt).call(this,I);if(C.controller.signal?.aborted)throw new Ie;return this._addRun(S(this,he,"m",ct).call(this))}static createThreadAssistantStream(e,t,s){let r=new Ce;return r._run(()=>r._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,s,r){let a=new Ce;return a._run(()=>a._runAssistantStream(e,t,s,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return S(this,kt,"f")}currentRun(){return S(this,At,"f")}currentMessageSnapshot(){return S(this,Oe,"f")}currentRunStepSnapshot(){return S(this,ot,"f")}async finalRunSteps(){return await this.done(),Object.values(S(this,Te,"f"))}async finalMessages(){return await this.done(),Object.values(S(this,xt,"f"))}async finalRun(){if(await this.done(),!S(this,He,"f"))throw Error("Final run was not received.");return S(this,He,"f")}async _createThreadAssistantStream(e,t,s){let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let a={...t,stream:!0},i=await e.createAndRun(a,{...s,signal:this.controller.signal});for await(let l of(this._connected(),i))S(this,he,"m",lt).call(this,l);if(i.controller.signal?.aborted)throw new Ie;return this._addRun(S(this,he,"m",ct).call(this))}async _createAssistantStream(e,t,s,r){let a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},l=await e.create(t,i,{...r,signal:this.controller.signal});for await(let C of(this._connected(),l))S(this,he,"m",lt).call(this,C);if(l.controller.signal?.aborted)throw new Ie;return this._addRun(S(this,he,"m",ct).call(this))}static accumulateDelta(e,t){for(let[s,r]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=r;continue}let a=e[s];if(a==null||s==="index"||s==="type"){e[s]=r;continue}if(typeof a=="string"&&typeof r=="string")a+=r;else if(typeof a=="number"&&typeof r=="number")a+=r;else if(es(a)&&es(r))a=this.accumulateDelta(a,r);else if(Array.isArray(a)&&Array.isArray(r)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...r);continue}for(let i of r){if(!es(i))throw Error(`Expected array delta entry to be an object but got: ${i}`);let l=i.index;if(l==null)throw console.error(i),Error("Expected array delta entry to have an `index` property");if(typeof l!="number")throw Error(`Expected array delta entry \`index\` property to be a number but got ${l}`);let C=a[l];C==null?a.push(i):a[l]=this.accumulateDelta(C,i)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${r}, accValue: ${a}`);e[s]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,r){return await this._createAssistantStream(t,e,s,r)}async _runToolAssistantStream(e,t,s,r,a){return await this._createToolAssistantStream(s,e,t,r,a)}}lt=function(n){if(!this.ended)switch(Ae(this,kt,n,"f"),S(this,he,"m",Cs).call(this,n),n.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":S(this,he,"m",Ms).call(this,n);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":S(this,he,"m",$s).call(this,n);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":S(this,he,"m",Is).call(this,n);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},ct=function(){if(this.ended)throw new L("stream has ended, this shouldn't happen");if(!S(this,He,"f"))throw Error("Final run has not been received");return S(this,He,"f")},Is=function(n){let[e,t]=S(this,he,"m",js).call(this,n,S(this,Oe,"f"));for(let s of(Ae(this,Oe,e,"f"),S(this,xt,"f")[e.id]=e,t)){let r=e.content[s.index];r?.type=="text"&&this._emit("textCreated",r.text)}switch(n.event){case"thread.message.created":this._emit("messageCreated",n.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",n.data.delta,e),n.data.delta.content)for(let s of n.data.delta.content){if(s.type=="text"&&s.text){let r=s.text,a=e.content[s.index];if(a&&a.type=="text")this._emit("textDelta",r,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=S(this,ze,"f")){if(S(this,Ke,"f"))switch(S(this,Ke,"f").type){case"text":this._emit("textDone",S(this,Ke,"f").text,S(this,Oe,"f"));break;case"image_file":this._emit("imageFileDone",S(this,Ke,"f").image_file,S(this,Oe,"f"))}Ae(this,ze,s.index,"f")}Ae(this,Ke,e.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(S(this,ze,"f")!==void 0){let s=n.data.content[S(this,ze,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,S(this,Oe,"f"));break;case"text":this._emit("textDone",s.text,S(this,Oe,"f"))}}S(this,Oe,"f")&&this._emit("messageDone",n.data),Ae(this,Oe,void 0,"f")}},$s=function(n){let e=S(this,he,"m",Ts).call(this,n);switch(Ae(this,ot,e,"f"),n.event){case"thread.run.step.created":this._emit("runStepCreated",n.data);break;case"thread.run.step.delta":let t=n.data.delta;if(t.step_details&&t.step_details.type=="tool_calls"&&t.step_details.tool_calls&&e.step_details.type=="tool_calls")for(let s of t.step_details.tool_calls)s.index==S(this,Et,"f")?this._emit("toolCallDelta",s,e.step_details.tool_calls[s.index]):(S(this,ke,"f")&&this._emit("toolCallDone",S(this,ke,"f")),Ae(this,Et,s.index,"f"),Ae(this,ke,e.step_details.tool_calls[s.index],"f"),S(this,ke,"f")&&this._emit("toolCallCreated",S(this,ke,"f")));this._emit("runStepDelta",n.data.delta,e);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Ae(this,ot,void 0,"f"),n.data.step_details.type=="tool_calls"&&S(this,ke,"f")&&(this._emit("toolCallDone",S(this,ke,"f")),Ae(this,ke,void 0,"f")),this._emit("runStepDone",n.data,e)}},Cs=function(n){S(this,Lt,"f").push(n),this._emit("event",n)},Ts=function(n){switch(n.event){case"thread.run.step.created":return S(this,Te,"f")[n.data.id]=n.data,n.data;case"thread.run.step.delta":let e=S(this,Te,"f")[n.data.id];if(!e)throw Error("Received a RunStepDelta before creation of a snapshot");let t=n.data;if(t.delta){let s=Ce.accumulateDelta(e,t.delta);S(this,Te,"f")[n.data.id]=s}return S(this,Te,"f")[n.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":S(this,Te,"f")[n.data.id]=n.data}if(S(this,Te,"f")[n.data.id])return S(this,Te,"f")[n.data.id];throw Error("No snapshot available")},js=function(n,e){let t=[];switch(n.event){case"thread.message.created":return[n.data,t];case"thread.message.delta":if(!e)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=n.data;if(s.delta.content)for(let r of s.delta.content)if(r.index in e.content){let a=e.content[r.index];e.content[r.index]=S(this,he,"m",Ns).call(this,r,a)}else e.content[r.index]=r,t.push(r);return[e,t];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(e)return[e,t];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Ns=function(n,e){return Ce.accumulateDelta(e,n)},Ms=function(n){switch(Ae(this,At,n.data,"f"),n.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Ae(this,He,n.data,"f"),S(this,ke,"f")&&(this._emit("toolCallDone",S(this,ke,"f")),Ae(this,ke,void 0,"f"))}};class ps extends K{create(e,t,s){return this._client.post(`/threads/${e}/messages`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/threads/${e}/messages/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}update(e,t,s,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:s,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},s){return we(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,ms,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(e,t,s){return this._client.delete(`/threads/${e}/messages/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}}class ms extends qe{}ps.MessagesPage=ms;class gs extends K{retrieve(e,t,s,r={},a){return we(r)?this.retrieve(e,t,s,{},r):this._client.get(`/threads/${e}/runs/${t}/steps/${s}`,{query:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a?.headers}})}list(e,t,s={},r){return we(s)?this.list(e,t,{},s):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,_s,{query:s,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class _s extends qe{}gs.RunStepsPage=_s;class gt extends K{constructor(){super(...arguments),this.steps=new gs(this._client)}create(e,t,s){let{include:r,...a}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:r},body:a,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers},stream:t.stream??!1})}retrieve(e,t,s){return this._client.get(`/threads/${e}/runs/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}update(e,t,s,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:s,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},s){return we(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,ys,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}cancel(e,t,s){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){let r=await this.create(e,t,s);return await this.poll(e,r.id,s)}createAndStream(e,t,s){return Ce.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){let r={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){let{data:a,response:i}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...r}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let l=5e3;if(s?.pollIntervalMs)l=s.pollIntervalMs;else{let C=i.headers.get("openai-poll-after-ms");if(C){let I=parseInt(C);isNaN(I)||(l=I)}}await ut(l);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,s){return Ce.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:s,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:s.stream??!1})}async submitToolOutputsAndPoll(e,t,s,r){let a=await this.submitToolOutputs(e,t,s,r);return await this.poll(e,a.id,r)}submitToolOutputsStream(e,t,s,r){return Ce.createToolAssistantStream(e,t,this._client.beta.threads.runs,s,r)}}class ys extends qe{}gt.RunsPage=ys,gt.Steps=gs,gt.RunStepsPage=_s;class nt extends K{constructor(){super(...arguments),this.runs=new gt(this._client),this.messages=new ps(this._client)}create(e={},t){return we(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/threads/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){let s=await this.createAndRun(e,t);return await this.runs.poll(s.thread_id,s.id,t)}createAndRunStream(e,t){return Ce.createThreadAssistantStream(e,this._client.beta.threads,t)}}nt.Runs=gt,nt.RunsPage=ys,nt.Messages=ps,nt.MessagesPage=ms;let Er=async n=>{let e=await Promise.allSettled(n),t=e.filter(r=>r.status==="rejected");if(t.length){for(let r of t)console.error(r.reason);throw Error(`${t.length} promise(s) failed - see the above errors`)}let s=[];for(let r of e)r.status==="fulfilled"&&s.push(r.value);return s};class ws extends K{create(e,t,s){return this._client.post(`/vector_stores/${e}/files`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/vector_stores/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},s){return we(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,$t,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(e,t,s){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){let r=await this.create(e,t,s);return await this.poll(e,r.id,s)}async poll(e,t,s){let r={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){let a=await this.retrieve(e,t,{...s,headers:r}).withResponse(),i=a.data;switch(i.status){case"in_progress":let l=5e3;if(s?.pollIntervalMs)l=s.pollIntervalMs;else{let C=a.response.headers.get("openai-poll-after-ms");if(C){let I=parseInt(C);isNaN(I)||(l=I)}}await ut(l);break;case"failed":case"completed":return i}}}async upload(e,t,s){let r=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:r.id},s)}async uploadAndPoll(e,t,s){let r=await this.upload(e,t,s);return await this.poll(e,r.id,s)}}class $t extends qe{}ws.VectorStoreFilesPage=$t;class Cn extends K{create(e,t,s){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}cancel(e,t,s){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){let r=await this.create(e,t);return await this.poll(e,r.id,s)}listFiles(e,t,s={},r){return we(s)?this.listFiles(e,t,{},s):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,$t,{query:s,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async poll(e,t,s){let r={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){let{data:a,response:i}=await this.retrieve(e,t,{...s,headers:r}).withResponse();switch(a.status){case"in_progress":let l=5e3;if(s?.pollIntervalMs)l=s.pollIntervalMs;else{let C=i.headers.get("openai-poll-after-ms");if(C){let I=parseInt(C);isNaN(I)||(l=I)}}await ut(l);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},r){if(t==null||t.length==0)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let a=Math.min(r?.maxConcurrency??5,t.length),i=this._client,l=t.values(),C=[...s];async function I(_){for(let v of _){let o=await i.files.create({file:v,purpose:"assistants"},r);C.push(o.id)}}let W=Array(a).fill(l).map(I);return await Er(W),await this.createAndPoll(e,{file_ids:C})}}class rt extends K{constructor(){super(...arguments),this.files=new ws(this._client),this.fileBatches=new Cn(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/vector_stores/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e={},t){return we(e)?this.list({},e):this._client.getAPIList("/vector_stores",bs,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class bs extends qe{}rt.VectorStoresPage=bs,rt.Files=ws,rt.VectorStoreFilesPage=$t,rt.FileBatches=Cn;class Xe extends K{constructor(){super(...arguments),this.vectorStores=new rt(this._client),this.chat=new fs(this._client),this.assistants=new us(this._client),this.threads=new nt(this._client)}}Xe.VectorStores=rt,Xe.VectorStoresPage=bs,Xe.Assistants=us,Xe.AssistantsPage=hs,Xe.Threads=nt;class vs extends K{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return we(e)?this.list({},e):this._client.getAPIList("/batches",xs,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class xs extends qe{}vs.BatchesPage=xs;class Tn extends K{create(e,t,s){return this._client.post(`/uploads/${e}/parts`,Qe({body:t,...s}))}}class Es extends K{constructor(){super(...arguments),this.parts=new Tn(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(`/uploads/${e}/complete`,{body:t,...s})}}Es.Parts=Tn;class U extends ir{constructor({baseURL:e=Ot("OPENAI_BASE_URL"),apiKey:t=Ot("OPENAI_API_KEY"),organization:s=Ot("OPENAI_ORG_ID")??null,project:r=Ot("OPENAI_PROJECT_ID")??null,...a}={}){if(t===void 0)throw new L("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let i={apiKey:t,organization:s,project:r,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&yr())throw new L(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new pn(this),this.chat=new ts(this),this.embeddings=new gn(this),this.files=new ss(this),this.images=new yn(this),this.audio=new ht(this),this.moderations=new xn(this),this.models=new rs(this),this.fineTuning=new dt(this),this.beta=new Xe(this),this.batches=new vs(this),this.uploads=new Es(this),this._options=i,this.apiKey=t,this.organization=s,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return function(t,s={}){let r,a=t,i=function(o=ce){let $;if(o.allowEmptyArrays!==void 0&&typeof o.allowEmptyArrays!="boolean")throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(o.encodeDotInKeys!==void 0&&typeof o.encodeDotInKeys!="boolean")throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(o.encoder!==null&&o.encoder!==void 0&&typeof o.encoder!="function")throw TypeError("Encoder has to be a function.");let oe=o.charset||ce.charset;if(o.charset!==void 0&&o.charset!=="utf-8"&&o.charset!=="iso-8859-1")throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let Q=Jt;if(o.format!==void 0){if(!Xn.call(Ht,o.format))throw TypeError("Unknown format option provided.");Q=o.format}let Y=Ht[Q],se=ce.filter;if((typeof o.filter=="function"||Ne(o.filter))&&(se=o.filter),$=o.arrayFormat&&o.arrayFormat in Bs?o.arrayFormat:"indices"in o?o.indices?"indices":"repeat":ce.arrayFormat,"commaRoundTrip"in o&&typeof o.commaRoundTrip!="boolean")throw TypeError("`commaRoundTrip` must be a boolean, or absent");let fe=o.allowDots===void 0?!!o.encodeDotInKeys||ce.allowDots:!!o.allowDots;return{addQueryPrefix:typeof o.addQueryPrefix=="boolean"?o.addQueryPrefix:ce.addQueryPrefix,allowDots:fe,allowEmptyArrays:typeof o.allowEmptyArrays=="boolean"?!!o.allowEmptyArrays:ce.allowEmptyArrays,arrayFormat:$,charset:oe,charsetSentinel:typeof o.charsetSentinel=="boolean"?o.charsetSentinel:ce.charsetSentinel,commaRoundTrip:!!o.commaRoundTrip,delimiter:o.delimiter===void 0?ce.delimiter:o.delimiter,encode:typeof o.encode=="boolean"?o.encode:ce.encode,encodeDotInKeys:typeof o.encodeDotInKeys=="boolean"?o.encodeDotInKeys:ce.encodeDotInKeys,encoder:typeof o.encoder=="function"?o.encoder:ce.encoder,encodeValuesOnly:typeof o.encodeValuesOnly=="boolean"?o.encodeValuesOnly:ce.encodeValuesOnly,filter:se,format:Q,formatter:Y,serializeDate:typeof o.serializeDate=="function"?o.serializeDate:ce.serializeDate,skipNulls:typeof o.skipNulls=="boolean"?o.skipNulls:ce.skipNulls,sort:typeof o.sort=="function"?o.sort:null,strictNullHandling:typeof o.strictNullHandling=="boolean"?o.strictNullHandling:ce.strictNullHandling}}(s);typeof i.filter=="function"?a=(0,i.filter)("",a):Ne(i.filter)&&(r=i.filter);let l=[];if(typeof a!="object"||a===null)return"";let C=Bs[i.arrayFormat],I=C==="comma"&&i.commaRoundTrip;r||(r=Object.keys(a)),i.sort&&r.sort(i.sort);let W=new WeakMap;for(let o=0;o<r.length;++o){let $=r[o];i.skipNulls&&a[$]===null||Ds(l,function oe(Q,Y,se,fe,ve,Z,le,Se,ee,xe,pe,De,Je,Fe,Ve,_t,Ct,As){var yt,at;let wt,V=Q,Tt=As,jt=0,qn=!1;for(;(Tt=Tt.get(Kt))!==void 0&&!qn;){let ge=Tt.get(Q);if(jt+=1,ge!==void 0){if(ge===jt)throw RangeError("Cyclic object value");qn=!0}Tt.get(Kt)===void 0&&(jt=0)}if(typeof xe=="function"?V=xe(Y,V):V instanceof Date?V=Je?.(V):se==="comma"&&Ne(V)&&(V=qs(V,function(ge){return ge instanceof Date?Je?.(ge):ge})),V===null){if(Z)return ee&&!_t?ee(Y,ce.encoder,Ct,"key",Fe):Y;V=""}if(typeof(yt=V)=="string"||typeof yt=="number"||typeof yt=="boolean"||typeof yt=="symbol"||typeof yt=="bigint"||(at=V)&&typeof at=="object"&&at.constructor&&at.constructor.isBuffer&&at.constructor.isBuffer(at)){if(ee){let ge=_t?Y:ee(Y,ce.encoder,Ct,"key",Fe);return[Ve?.(ge)+"="+Ve?.(ee(V,ce.encoder,Ct,"value",Fe))]}return[Ve?.(Y)+"="+Ve?.(String(V))]}let Ss=[];if(V===void 0)return Ss;if(se==="comma"&&Ne(V))_t&&ee&&(V=qs(V,ee)),wt=[{value:V.length>0?V.join(",")||null:void 0}];else if(Ne(xe))wt=xe;else{let ge=Object.keys(V);wt=pe?ge.sort(pe):ge}let Bn=Se?String(Y).replace(/\./g,"%2E"):String(Y),Nt=fe&&Ne(V)&&V.length===1?Bn+"[]":Bn;if(ve&&Ne(V)&&V.length===0)return Nt+"[]";for(let ge=0;ge<wt.length;++ge){let it=wt[ge],Dn=typeof it=="object"&&it.value!==void 0?it.value:V[it];if(le&&Dn===null)continue;let Ps=De&&Se?it.replace(/\./g,"%2E"):it,Dr=Ne(V)?typeof se=="function"?se(Nt,Ps):Nt:Nt+(De?"."+Ps:"["+Ps+"]");As.set(Q,jt);let Fn=new WeakMap;Fn.set(Kt,As),Ds(Ss,oe(Dn,Dr,se,fe,ve,Z,le,Se,se==="comma"&&_t&&Ne(V)?null:ee,xe,pe,De,Je,Fe,Ve,_t,Ct,Fn))}return Ss}(a[$],$,C,I,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,W))}let _=l.join(i.delimiter),v=i.addQueryPrefix===!0?"?":"";return i.charsetSentinel&&(i.charset==="iso-8859-1"?v+="utf8=%26%2310003%3B&":v+="utf8=%E2%9C%93&"),_.length>0?v+_:""}(e,{arrayFormat:"brackets"})}}U.OpenAI=U,U.DEFAULT_TIMEOUT=6e5,U.OpenAIError=L,U.APIError=de,U.APIConnectionError=St,U.APIConnectionTimeoutError=Xt,U.APIUserAbortError=Ie,U.NotFoundError=Js,U.ConflictError=Hs,U.RateLimitError=Gs,U.BadRequestError=Ls,U.AuthenticationError=Us,U.InternalServerError=Xs,U.PermissionDeniedError=Ws,U.UnprocessableEntityError=Ks,U.toFile=sn,U.fileFromPath=y,U.Completions=pn,U.Chat=ts,U.Embeddings=gn,U.Files=ss,U.FileObjectsPage=ns,U.Images=yn,U.Audio=ht,U.Moderations=xn,U.Models=rs,U.ModelsPage=as,U.FineTuning=dt,U.Beta=Xe,U.Batches=vs,U.BatchesPage=xs,U.Uploads=Es;let kr=new U({apiKey:process.env.OPENAI_API_KEY}),Ar=`You are an expert Stable Diffusion inpainting prompt engineer. Your task is to create detailed prompts that help generate images fitting perfectly into existing scenes.

Given the scene description and user's request, create a prompt that:
1. Focuses on the specific object/area to be generated
2. Matches the scene's lighting, perspective, and atmosphere
3. Ensures seamless integration with surroundings
4. Includes technical quality terms

Format output as:
PROMPT: [main prompt]
NEG: [negative prompt]`;async function Sr(n,e){try{if(!process.env.OPENAI_API_KEY)return console.error("OpenAI API key is not configured"),n;let t=await kr.chat.completions.create({model:"gpt-4o-mini",messages:[{role:"system",content:Ar},{role:"user",content:`Scene context: ${e}
User request: ${n}`}],temperature:.7,max_tokens:200});return t.choices[0]?.message?.content?t.choices[0].message.content||n:(console.error("No content in OpenAI response:",t),n)}catch(t){return t instanceof Error?console.error("OpenAI API Error:",{name:t.name,message:t.message,stack:t.stack}):console.error("Unknown error type:",t),n}}let Pr=process.env.REPLICATE_API_KEY,Rr=new(Kn())({auth:Pr}),Or=async(n,e,t,s)=>{try{let[r,a]=(await Sr(n,s)).split(`
NEG: `),i={prompt:r.replace("PROMPT: ",""),negative_prompt:a,mask:t,image:e,num_outputs:1,num_inference_steps:50,guidance_scale:7.5,seed:0};console.log("replicate",i);let l=await Rr.run("andreasjansson/stable-diffusion-inpainting:e490d072a34a94a11e9711ed5a6ba621c3fab884eda1665d9d3a282d65a21180",{input:i});return Array.isArray(l)&&l.length>0?l[0]:l}catch(r){throw console.error("Error running model:",r),r}};var jn=u(2016);let Ir="edge";async function $r(n){try{let{prompt:e,image:t,mask:s,sceneContext:r}=await n.json(),a=await Or(e,t,s,r);return jn.Z.json(a)}catch(e){return console.error("Error running model:",e),jn.Z.json({error:"Error running model"},{status:500})}}let ks=new Un.AppRouteRouteModule({definition:{kind:Wn.x.APP_ROUTE,page:"/api/runModel/route",pathname:"/api/runModel",filename:"route",bundlePath:"app/api/runModel/route"},resolvedPagePath:"/Users/kristen/Documents/code/personal/ai-generative-fill/app/api/runModel/route.ts",nextConfigOutput:"",userland:Ut}),{requestAsyncStorage:Cr,staticGenerationAsyncStorage:Nn,serverHooks:Mn,headerHooks:Tr,staticGenerationBailout:jr}=ks,Nr="/api/runModel/route";function Mr(){return(0,Jn.XH)({serverHooks:Mn,staticGenerationAsyncStorage:Nn})}let qr=Wt,Br=Ln.a.wrap(ks)},678:Da,5503:ha,6225:Ba,261:qa,9726:Ma,4464:Na,6840:ja,9532:Ta,5466:ua,8050:ca,2834:la,3444:oa,7484:ia,9504:aa,7212:ra,7988:na,2144:sa,7785:ta,1316:Ca,2035:ea,1725:Zr,4851:Yr,6329:$a,5936:Qr,1430:Ia,7795:Oa,6558:zr,6438:Vr,4275:Xr,8055:Ra,2016:La,1622:Pa,9135:Sa,7756:Aa,3578:ka,2200:Ea,7899:xa,4606:va,9386:ba,7502:wa,966:ya,2036:_a,1797:ga,2745:ma,8278:pa,8216:Gr,7584:Kr,7809:Hr,6774:Jr,9572:(N,q,u)=>{"use strict";let d=u(4955),b=u(2530),{createReadableStream:p}=u(9821),{withAutomaticRetries:M,validateWebhook:P,parseProgressFromLogs:g,streamAsyncIterator:x}=u(19),m=u(7854),y=u(2838),f=u(9796),h=u(1902),T=u(3570),E=u(6703),c=u(9888),k=u(2157),w=u(8645),R=u(5453);class O{constructor(A={}){this.auth=A.auth||(typeof process<"u"?process.env.REPLICATE_API_TOKEN:null),this.userAgent=A.userAgent||`replicate-javascript/${R.version}`,this.baseUrl=A.baseUrl||"https://api.replicate.com/v1",this.fetch=A.fetch||Pe.fetch,this.fileEncodingStrategy=A.fileEncodingStrategy??"default",this.accounts={current:m.current.bind(this)},this.collections={list:y.list.bind(this),get:y.get.bind(this)},this.deployments={get:f.get.bind(this),create:f.create.bind(this),update:f.update.bind(this),delete:f.delete.bind(this),list:f.list.bind(this),predictions:{create:f.predictions.create.bind(this)}},this.files={create:h.create.bind(this),get:h.get.bind(this),list:h.list.bind(this),delete:h.delete.bind(this)},this.hardware={list:T.list.bind(this)},this.models={get:E.get.bind(this),list:E.list.bind(this),create:E.create.bind(this),versions:{list:E.versions.list.bind(this),get:E.versions.get.bind(this)},search:E.search.bind(this)},this.predictions={create:c.create.bind(this),get:c.get.bind(this),cancel:c.cancel.bind(this),list:c.list.bind(this)},this.trainings={create:k.create.bind(this),get:k.get.bind(this),cancel:k.cancel.bind(this),list:k.list.bind(this)},this.webhooks={default:{secret:{get:w.default.secret.get.bind(this)}}}}async run(A,J,D){let j,{wait:ie,signal:B,...H}=J,ne=b.parse(A);if(ne.version)j=await this.predictions.create({...H,version:ne.version});else if(ne.owner&&ne.name)j=await this.predictions.create({...H,model:`${ne.owner}/${ne.name}`});else throw Error("Invalid model version identifier");if(D&&D(j),j=await this.wait(j,ie||{},async ye=>(D&&D(ye),!!B&&!!B.aborted)),B&&B.aborted&&(j=await this.predictions.cancel(j.id)),D&&D(j),j.status==="failed")throw Error(`Prediction failed: ${j.error}`);return j.output}async request(A,J){let D,j,{auth:ie,baseUrl:B,userAgent:H}=this;D=A instanceof URL?A:new URL(A.startsWith("/")?A.slice(1):A,B.endsWith("/")?B:`${B}/`);let{method:ne="GET",params:ye={},data:Re}=J;for(let[z,me]of Object.entries(ye))D.searchParams.append(z,me);let Ee={"Content-Type":"application/json","User-Agent":H};if(ie&&(Ee.Authorization=`Bearer ${ie}`),J.headers)for(let[z,me]of Object.entries(J.headers))Ee[z]=me;Re instanceof FormData?(j=Re,delete Ee["Content-Type"]):Re&&(j=JSON.stringify(Re));let Be={method:ne,headers:Ee,body:j},Ue=this.fetch,G=await M(async()=>Ue(D,Be),{shouldRetry:ne==="GET"?z=>z.status===429||z.status>=500:z=>z.status===429});if(!G.ok){let z=new Request(D,Be),me=await G.text();throw new d(`Request to ${D} failed with status ${G.status} ${G.statusText}: ${me}.`,z,G)}return G}async*stream(A,J){let D,{wait:j,signal:ie,...B}=J,H=b.parse(A);if(H.version)D=await this.predictions.create({...B,version:H.version,stream:!0});else if(H.owner&&H.name)D=await this.predictions.create({...B,model:`${H.owner}/${H.name}`,stream:!0});else throw Error("Invalid model version identifier");if(D.urls&&D.urls.stream){let ne=p({url:D.urls.stream,fetch:this.fetch,...ie?{options:{signal:ie}}:{}});yield*x(ne)}else throw Error("Prediction does not support streaming")}async*paginate(A){let J=await A();yield J.results,J.next&&(yield*this.paginate(()=>this.request(J.next,{method:"GET"}).then(D=>D.json())))}async wait(A,J,D){let{id:j}=A;if(!j)throw Error("Invalid prediction");if(A.status==="succeeded"||A.status==="failed"||A.status==="canceled")return A;let ie=ne=>new Promise(ye=>setTimeout(ye,ne)),B=J&&J.interval||500,H=await this.predictions.get(j);for(;H.status!=="succeeded"&&H.status!=="failed"&&H.status!=="canceled"&&(!D||await D(H)!==!0);)await ie(B),H=await this.predictions.get(A.id);if(H.status==="failed")throw Error(`Prediction failed: ${H.error}`);return H}}N.exports=O,N.exports.validateWebhook=P,N.exports.parseProgressFromLogs=g},7854:N=>{"use strict";async function q(){return(await this.request("/account",{method:"GET"})).json()}N.exports={current:q}},2838:N=>{"use strict";async function q(d){return(await this.request(`/collections/${d}`,{method:"GET"})).json()}async function u(){return(await this.request("/collections",{method:"GET"})).json()}N.exports={get:q,list:u}},9796:(N,q,u)=>{"use strict";let{transformFileInputs:d}=u(19);async function b(m,y,f){let{stream:h,input:T,...E}=f;if(E.webhook)try{new URL(E.webhook)}catch{throw Error("Invalid webhook URL")}return(await this.request(`/deployments/${m}/${y}/predictions`,{method:"POST",data:{...E,input:await d(this,T,this.fileEncodingStrategy),stream:h}})).json()}async function p(m,y){return(await this.request(`/deployments/${m}/${y}`,{method:"GET"})).json()}async function M(m){return(await this.request("/deployments",{method:"POST",data:m})).json()}async function P(m,y,f){return(await this.request(`/deployments/${m}/${y}`,{method:"PATCH",data:f})).json()}async function g(m,y){return(await this.request(`/deployments/${m}/${y}`,{method:"DELETE"})).status===204}async function x(){return(await this.request("/deployments",{method:"GET"})).json()}N.exports={predictions:{create:b},get:p,create:M,update:P,list:x,delete:g}},4955:N=>{"use strict";class q extends Error{constructor(d,b,p){super(d),this.name="ApiError",this.request=b,this.response=p}}N.exports=q},1902:(N,q,u)=>{"use strict";var d=u(6195).Buffer;async function b(g,x={}){let m,y,f=new FormData;if(g instanceof Blob)m=g.name||`blob_${Date.now()}`,y=g;else if(d.isBuffer(g)){m=`buffer_${Date.now()}`;let h=new Uint8Array(g);y=new Blob([h],{type:"application/octet-stream",name:m})}else throw Error("Invalid file argument, must be a Blob, File or Buffer");return f.append("content",y,m),f.append("metadata",new Blob([JSON.stringify(x)],{type:"application/json"})),(await this.request("/files",{method:"POST",data:f,headers:{"Content-Type":"multipart/form-data"}})).json()}async function p(){return(await this.request("/files",{method:"GET"})).json()}async function M(g){return(await this.request(`/files/${g}`,{method:"GET"})).json()}async function P(g){return(await this.request(`/files/${g}`,{method:"DELETE"})).status===204}N.exports={create:b,list:p,get:M,delete:P}},3570:N=>{"use strict";async function q(){return(await this.request("/hardware",{method:"GET"})).json()}N.exports={list:q}},2530:N=>{"use strict";class q{constructor(d,b,p=null){this.owner=d,this.name=b,this.version=p}static parse(d){let b=d.match(/^(?<owner>[^/]+)\/(?<name>[^/:]+)(:(?<version>.+))?$/);if(!b)throw Error(`Invalid reference to model version: ${d}. Expected format: owner/name or owner/name:version`);let{owner:p,name:M,version:P}=b.groups;return new q(p,M,P)}}N.exports=q},6703:N=>{"use strict";async function q(P,g){return(await this.request(`/models/${P}/${g}`,{method:"GET"})).json()}async function u(P,g){return(await this.request(`/models/${P}/${g}/versions`,{method:"GET"})).json()}async function d(P,g,x){return(await this.request(`/models/${P}/${g}/versions/${x}`,{method:"GET"})).json()}async function b(){return(await this.request("/models",{method:"GET"})).json()}async function p(P,g,x){let m={owner:P,name:g,...x};return(await this.request("/models",{method:"POST",data:m})).json()}async function M(P){return(await this.request("/models",{method:"QUERY",headers:{"Content-Type":"text/plain"},data:P})).json()}N.exports={get:q,list:b,create:p,versions:{list:u,get:d},search:M}},9888:(N,q,u)=>{"use strict";let{transformFileInputs:d}=u(19);async function b(g){let x,{model:m,version:y,stream:f,input:h,...T}=g;if(T.webhook)try{new URL(T.webhook)}catch{throw Error("Invalid webhook URL")}if(y)x=await this.request("/predictions",{method:"POST",data:{...T,input:await d(this,h,this.fileEncodingStrategy),version:y,stream:f}});else if(m)x=await this.request(`/models/${m}/predictions`,{method:"POST",data:{...T,input:await d(this,h,this.fileEncodingStrategy),stream:f}});else throw Error("Either model or version must be specified");return x.json()}async function p(g){return(await this.request(`/predictions/${g}`,{method:"GET"})).json()}async function M(g){return(await this.request(`/predictions/${g}/cancel`,{method:"POST"})).json()}async function P(){return(await this.request("/predictions",{method:"GET"})).json()}N.exports={create:b,get:p,cancel:M,list:P}},9821:(N,q,u)=>{"use strict";let d=u(4955),{streamAsyncIterator:b}=u(19),{EventSourceParserStream:p}=u(7380),{TextDecoderStream:M}=Pe.TextDecoderStream===void 0?u(6081):Pe;class P{constructor(x,m,y,f){this.event=x,this.data=m,this.id=y,this.retry=f}toString(){return this.event==="output"?this.data:""}}N.exports={createReadableStream:function({url:g,fetch:x,options:m={}}){return new ReadableStream({async start(y){let f={...m,headers:{...m.headers,Accept:"text/event-stream"}},h=await x(g,f);if(!h.ok){let T=await h.text(),E=new Request(g,f);y.error(new d(`Request to ${g} failed with status ${h.status}: ${T}`,E,h))}for await(let T of b(h.body.pipeThrough(new M).pipeThrough(new p))){if(T.event==="error"){y.error(Error(T.data));break}if(y.enqueue(new P(T.event,T.data,T.id)),T.event==="done")break}y.close()}})},ServerSentEvent:P}},2157:N=>{"use strict";async function q(p,M,P,g){let{...x}=g;if(x.webhook)try{new URL(x.webhook)}catch{throw Error("Invalid webhook URL")}return(await this.request(`/models/${p}/${M}/versions/${P}/trainings`,{method:"POST",data:x})).json()}async function u(p){return(await this.request(`/trainings/${p}`,{method:"GET"})).json()}async function d(p){return(await this.request(`/trainings/${p}/cancel`,{method:"POST"})).json()}async function b(){return(await this.request("/trainings",{method:"GET"})).json()}N.exports={create:q,get:u,cancel:d,list:b}},19:(N,q,u)=>{"use strict";var d=u(6195).Buffer;let b=u(4955),{create:p}=u(1902);async function M(c,k){let{id:w,timestamp:R,body:O,signature:F}=c,A=k||c.secret;if(c&&c.headers&&c.body&&(typeof c.headers.get=="function"?(w=c.headers.get("webhook-id"),R=c.headers.get("webhook-timestamp"),F=c.headers.get("webhook-signature")):(w=c.headers["webhook-id"],R=c.headers["webhook-timestamp"],F=c.headers["webhook-signature"]),O=c.body),O instanceof ReadableStream||O.readable)try{O=await new Response(O).text()}catch(j){throw Error(`Error reading body: ${j.message}`)}else if(T(O))O=await new Blob([O]).text();else if(typeof O=="object")O=JSON.stringify(O);else if(typeof O!="string")throw Error("Invalid body type");if(!w||!R||!F)throw Error("Missing required webhook headers");if(!O)throw Error("Missing required body");if(!A)throw Error("Missing required secret");let J=`${w}.${R}.${O}`,D=await P(A.split("_").pop(),J);return F.split(" ").map(j=>j.split(",")[1]).some(j=>j===D)}async function P(c,k){let w=new TextEncoder,R=Pe.crypto;R===void 0&&(R=u(1939).call(null,"node:crypto").webcrypto);let O=await R.subtle.importKey("raw",Uint8Array.from(atob(c),F=>F.codePointAt(0)),{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return g(await R.subtle.sign("HMAC",O,w.encode(k)))}function g(c){return btoa(String.fromCharCode.apply(null,new Uint8Array(c)))}async function x(c,k={}){let w=k.shouldRetry||(()=>!1),R=k.maxRetries||5,O=k.interval||500,F=k.jitter||100,A=D=>new Promise(j=>setTimeout(j,D)),J=0;do{let D=O*2**J+Math.random()*F;try{let j=await c();if(j.ok||!w(j))return j}catch(j){if(j instanceof b){let ie=j.response.headers.get("Retry-After");if(ie)if(Number.isInteger(ie))D=1e3*ie;else{let B=new Date(ie);Number.isNaN(B.getTime())||(D=B.getTime()-new Date().getTime())}}}Number.isInteger(R)&&R>0&&(Number.isInteger(D)&&D>0&&await A(O*2**(k.maxRetries-R)),J+=1)}while(J<R);return c()}async function m(c,k,w){switch(w){case"data-uri":return await f(c,k);case"upload":return await y(c,k);case"default":try{return await y(c,k)}catch(R){if(R instanceof b&&R.response.status>=400&&R.response.status<500)throw R;return await f(k)}default:throw Error(`Unexpected file upload strategy: ${w}`)}}async function y(c,k){return await h(k,async w=>w instanceof Blob||w instanceof d?(await p.call(c,w)).urls.get:w)}async function f(c){let k=0;return await h(c,async w=>{let R,O;if(w instanceof Blob)R=await w.arrayBuffer(),O=w.type;else{if(!T(w))return w;R=w}if((k+=R.byteLength)>1e7)throw Error(`Combined filesize of prediction ${k} bytes exceeds 10mb limit for inline encoding, please provide URLs instead`);let F=g(R);return O=O??"application/octet-stream",`data:${O};base64,${F}`})}async function h(c,k){if(Array.isArray(c)){let w=[];for(let R of c){let O=await h(R,k);w.push(O)}return w}if(function(w){if(!(typeof w=="object"&&w!==null)||String(w)!=="[object Object]")return!1;let R=Object.getPrototypeOf(w);if(R===null)return!0;let O=Object.prototype.hasOwnProperty.call(R,"constructor")&&R.constructor;return typeof O=="function"&&O instanceof O&&Function.prototype.toString.call(O)===Function.prototype.toString.call(Object)}(c)){let w={};for(let R of Object.keys(c))w[R]=await h(c[R],k);return w}return await k(c)}function T(c){return c instanceof Int8Array||c instanceof Int16Array||c instanceof Int32Array||c instanceof Uint8Array||c instanceof Uint8ClampedArray||c instanceof Uint16Array||c instanceof Uint32Array||c instanceof Float32Array||c instanceof Float64Array}async function*E(c){let k=c.getReader();try{for(;;){let{done:w,value:R}=await k.read();if(w)return;yield R}}finally{k.releaseLock()}}N.exports={transformFileInputs:m,validateWebhook:M,withAutomaticRetries:x,parseProgressFromLogs:function(c){let k=typeof c=="object"&&c.logs?c.logs:c;if(!k||typeof k!="string")return null;let w=/^\s*(\d+)%\s*\|.+?\|\s*(\d+)\/(\d+)/;for(let R of k.split(`
`).reverse()){let O=R.match(w);if(O&&O.length===4)return{percentage:parseInt(O[1],10)/100,current:parseInt(O[2],10),total:parseInt(O[3],10)}}return null},streamAsyncIterator:E}},8645:N=>{"use strict";async function q(){return(await this.request("/webhooks/default/secret",{method:"GET"})).json()}N.exports={default:{secret:{get:q}}}},7380:N=>{"use strict";var q=Object.defineProperty,u=Object.getOwnPropertyDescriptor,d=Object.getOwnPropertyNames,b=Object.prototype.hasOwnProperty,p={};((g,x)=>{for(var m in x)q(g,m,{get:x[m],enumerable:!0})})(p,{EventSourceParserStream:()=>P}),N.exports=((g,x,m,y)=>{if(x&&typeof x=="object"||typeof x=="function")for(let f of d(x))b.call(g,f)||f===void 0||q(g,f,{get:()=>x[f],enumerable:!(y=u(x,f))||y.enumerable});return g})(q({},"__esModule",{value:!0}),p);var M=[239,187,191],P=class extends TransformStream{constructor(){let g;super({start(x){g=function(m){let y,f,h,T,E,c,k;return w(),{feed:function(R){var O;f=f?f+R:R,y&&(O=f,M.every((D,j)=>O.charCodeAt(j)===D))&&(f=f.slice(M.length)),y=!1;let F=f.length,A=0,J=!1;for(;A<F;){let D;J&&(f[A]===`
`&&++A,J=!1);let j=-1,ie=T;for(let B=h;j<0&&B<F;++B)(D=f[B])===":"&&ie<0?ie=B-A:D==="\r"?(J=!0,j=B-A):D===`
`&&(j=B-A);if(j<0){h=F-A,T=ie;break}h=0,T=-1,function(B,H,ne,ye){if(ye===0){k.length>0&&(m({type:"event",id:E,event:c||void 0,data:k.slice(0,-1)}),k="",E=void 0),c=void 0;return}let Re=ne<0,Ee=B.slice(H,H+(Re?ye:ne)),Be=0;Be=Re?ye:B[H+ne+1]===" "?ne+2:ne+1;let Ue=H+Be,G=ye-Be,z=B.slice(Ue,Ue+G).toString();if(Ee==="data")k+=z?"".concat(z,`
`):`
`;else if(Ee==="event")c=z;else if(Ee!=="id"||z.includes("\0")){if(Ee==="retry"){let me=parseInt(z,10);Number.isNaN(me)||m({type:"reconnect-interval",value:me})}}else E=z}(f,A,ie,j),A+=j+1}A===F?f="":A>0&&(f=f.slice(A))},reset:w};function w(){y=!0,f="",h=0,T=-1,E=void 0,c=void 0,k=""}}(m=>{m.type==="event"&&x.enqueue(m)})},transform(x){g.feed(x)}})}}},6081:N=>{"use strict";var q=Object.defineProperty,u=Object.getOwnPropertyDescriptor,d=Object.getOwnPropertyNames,b=Object.prototype.hasOwnProperty,p={};((m,y)=>{for(var f in y)q(m,f,{get:y[f],enumerable:!0})})(p,{TextDecoderStream:()=>x}),N.exports=((m,y,f,h)=>{if(y&&typeof y=="object"||typeof y=="function")for(let T of d(y))b.call(m,T)||T===void 0||q(m,T,{get:()=>y[T],enumerable:!(h=u(y,T))||h.enumerable});return m})(q({},"__esModule",{value:!0}),p);var M=Symbol("decDecoder"),P=Symbol("decTransform"),g=class{constructor(m){this.decoder_=m}transform(m,y){if(!(m instanceof ArrayBuffer||ArrayBuffer.isView(m)))throw TypeError("Input data must be a BufferSource");let f=this.decoder_.decode(m,{stream:!0});f.length!==0&&y.enqueue(f)}flush(m){let y=this.decoder_.decode();y.length!==0&&m.enqueue(y)}},x=class{constructor(m,y){let f=new TextDecoder(m||"utf-8",y||{});this[M]=f,this[P]=new TransformStream(new g(f))}get encoding(){return this[M].encoding}get fatal(){return this[M].fatal}get ignoreBOM(){return this[M].ignoreBOM}get readable(){return this[P].readable}get writable(){return this[P].writable}};Symbol("encEncoder"),Symbol("encTransform")},5453:N=>{"use strict";N.exports=JSON.parse('{"name":"replicate","version":"0.32.1","description":"JavaScript client for Replicate","repository":"github:replicate/replicate-javascript","homepage":"https://github.com/replicate/replicate-javascript#readme","bugs":"https://github.com/replicate/replicate-javascript/issues","license":"Apache-2.0","main":"index.js","type":"commonjs","types":"index.d.ts","files":["CONTRIBUTING.md","LICENSE","README.md","index.d.ts","index.js","lib/**/*.js","vendor/**/*","package.json"],"engines":{"node":">=18.0.0","npm":">=7.19.0","git":">=2.11.0","yarn":">=1.7.0"},"scripts":{"check":"tsc","format":"biome format . --write","lint-biome":"biome lint .","lint-publint":"publint","lint":"npm run lint-biome && npm run lint-publint","test":"jest"},"optionalDependencies":{"readable-stream":">=4.0.0"},"devDependencies":{"@biomejs/biome":"^1.4.1","@types/jest":"^29.5.3","@typescript-eslint/eslint-plugin":"^5.56.0","cross-fetch":"^3.1.5","jest":"^29.7.0","nock":"^14.0.0-beta.6","publint":"^0.2.7","ts-jest":"^29.1.0","typescript":"^5.0.2"}}')}},N=>{var q=N(N.s=9142);(Pe._ENTRIES=typeof Pe._ENTRIES>"u"?{}:Pe._ENTRIES)["middleware_app/api/runModel/route"]=q}]),function(){let N={exports:{},loaded:!1};return function(u,d){var b=Object.defineProperty,p=h=>b(h,"__esModule",{value:!0}),M=(h,T)=>{p(h);for(var E in T)b(h,E,{get:T[E],enumerable:!0})};M(d,{default:()=>x});function P(h){let T={};return h&&h.forEach((E,c)=>{T[c]=E,c.toLowerCase()==="set-cookie"&&(T[c]=g(E))}),T}function g(h){let T=[],E=0,c,k,w,R,O;function F(){for(;E<h.length&&/\s/.test(h.charAt(E));)E+=1;return E<h.length}function A(){return k=h.charAt(E),k!=="="&&k!==";"&&k!==","}for(;E<h.length;){for(c=E,O=!1;F();)if(k=h.charAt(E),k===","){for(w=E,E+=1,F(),R=E;E<h.length&&A();)E+=1;E<h.length&&h.charAt(E)==="="?(O=!0,E=R,T.push(h.substring(c,w)),c=E):E=w+1}else E+=1;(!O||E>=h.length)&&T.push(h.substring(c,h.length))}return T}function x(h){let T=h.staticRoutes.map(c=>({regexp:new RegExp(c.namedRegex),page:c.page})),E=h.dynamicRoutes?.map(c=>({regexp:new RegExp(c.namedRegex),page:c.page}))||[];return async function(c,k){let w=new URL(c.url).pathname,R={};if(h.nextConfig?.basePath&&w.startsWith(h.nextConfig.basePath)&&(w=w.replace(h.nextConfig.basePath,"")||"/"),h.nextConfig?.i18n)for(let F of h.nextConfig.i18n.locales){let A=new RegExp(`^/${F}($|/)`,"i");if(w.match(A)){w=w.replace(A,"/")||"/";break}}for(let F of T)if(F.regexp.exec(w)){R.name=F.page;break}if(!R.name){let F=y(w);for(let A of E||[]){if(F&&!y(A.page))continue;let J=A.regexp.exec(w);if(J){R={name:A.page,params:J.groups};break}}}let O=await Pe._ENTRIES[`middleware_${h.name}`].default.call({},{request:{url:c.url,method:c.method,headers:P(c.headers),ip:m(c.headers,f.Ip),geo:{city:m(c.headers,f.City,!0),country:m(c.headers,f.Country,!0),latitude:m(c.headers,f.Latitude),longitude:m(c.headers,f.Longitude),region:m(c.headers,f.Region,!0)},nextConfig:h.nextConfig,page:R,body:c.body}});return k.waitUntil(O.waitUntil),O.response}}function m(h,T,E=!1){let c=h.get(T)||void 0;return E&&c?decodeURIComponent(c):c}function y(h){return h==="/api"||h.startsWith("/api/")}var f;(function(h){h.City="x-vercel-ip-city",h.Country="x-vercel-ip-country",h.Ip="x-real-ip",h.Latitude="x-vercel-ip-latitude",h.Longitude="x-vercel-ip-longitude",h.Region="x-vercel-ip-country-region"})(f||(f={}))}(N,N.exports),N.exports}.call({}).default({name:"app/api/runModel/route",staticRoutes:[{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"}],dynamicRoutes:[{page:"/[lang]",regex:"^/([^/]+?)(?:/)?$",routeKeys:{nxtPlang:"nxtPlang"},namedRegex:"^/(?<nxtPlang>[^/]+?)(?:/)?$"},{page:"/[lang]/newPage",regex:"^/([^/]+?)/newPage(?:/)?$",routeKeys:{nxtPlang:"nxtPlang"},namedRegex:"^/(?<nxtPlang>[^/]+?)/newPage(?:/)?$"},{page:"/[lang]/playground",regex:"^/([^/]+?)/playground(?:/)?$",routeKeys:{nxtPlang:"nxtPlang"},namedRegex:"^/(?<nxtPlang>[^/]+?)/playground(?:/)?$"},{page:"/[lang]/privacy",regex:"^/([^/]+?)/privacy(?:/)?$",routeKeys:{nxtPlang:"nxtPlang"},namedRegex:"^/(?<nxtPlang>[^/]+?)/privacy(?:/)?$"},{page:"/[lang]/tos",regex:"^/([^/]+?)/tos(?:/)?$",routeKeys:{nxtPlang:"nxtPlang"},namedRegex:"^/(?<nxtPlang>[^/]+?)/tos(?:/)?$"}],nextConfig:{basePath:""}})))(_e,_e,_e);export{za as default};
